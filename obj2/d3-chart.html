<!DOCTYPE html>
<html>
    
  <head>
    <meta charset="utf-8">
    <title>Insertion and Deletion per Month Bar Chart</title>
    <link rel="stylesheet" href="normalize.css">
      <style>
          form {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            position: absolute;
            left: 10px;
            top: 10px;
          }

          label {
              display: block;
          }
          .tooltip {
              background: #eee; 
              box-shadow: 0 0 5px #999999; 
              color: #333;
              display: none;
              font-size: 12px;
              left: 130px;
              padding: 10px;
              position: absolute;
              text-align: center;
              top: 95px;
              width: 80px;
              z-index: 10;
        }
        .legend {
            font-size: 12px;
        }
        rect {
            cursor:pointer;
            stroke-width: 2;
        } 
        rect.disabled {
            fill: transparent !important;
        } 
        h1 {
            font-size: 14px; 
            text-align: center;
        }
        
    </style>
  </head>
  <body>
    <h1>Insertion and Deletion from Jan to June 2016</h1>
    <form>
    <label><input type="radio" name="mode" value="grouped"> Grouped</label>
    <label><input type="radio" name="mode" value="stacked" checked> Stacked</label>
    </form>
    <svg width="960" height="500"></svg>
    <div id="chart"></div>
    <script src="d3.v4.min.js"></script>
    <script>
      
      (function(d3) {
        'use strict';
          
        var tooltip = d3.select('#chart') 
            .append('div')
            .attr('class', 'tooltip');
        
        tooltip.append('div') 
            .attr('class', 'label');
        tooltip.append('div') 
            .attr('class', 'count');
        tooltip.append('div') // NEW 
            .attr('class', 'percent');
        
        d3.csv('changedLine.csv', function(error, dataset) {
            dataset.forEach(function(d) { 
            d.count = +d.count;
            d.enabled = true;
        });
        var n = 2, // Insertion and deletion
            m = 6; // Jan, Feb, Mar, Apr, May, Jun
          
        // Each yz[i] is an array of m non-negative numbers representing a y-value for xz[i].
        // The y01z array has the same structure as yz, but with stacked [y₀, y₁] instead of y.
        var xz = d3.range(m),
            yz = d3.range(n).map(function() { return bumps(m); }),
            y01z = d3.stack().keys(d3.range(n))(d3.transpose(yz)),
            yMax = d3.max(yz, function(y) { return d3.max(y); }),
            y1Max = d3.max(y01z, function(y) { return d3.max(y, function(d) { return d[1]; }); });

        var svg = d3.select("svg"),
            margin = {top: 40, right: 10, bottom: 20, left: 10},
            width = +svg.attr("width") - margin.left - margin.right,
            height = +svg.attr("height") - margin.top - margin.bottom,
            g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");  
          
        var svg = d3.select('#chart')
          .append('svg')
          .attr('width', width)
          .attr('height', height)
          .append('g')
          .attr('transform', 'translate(' + (width / 2) +
            ',' + (height / 2) + ')');

        var x = d3.scaleBand()
            .domain(xz)
            .rangeRound([0, width])
            .padding(0.08);
          
        var y = d3.scaleLinear()
            .domain([0, y1Max])
            .range([height, 0]);

        var color = d3.scaleOrdinal()
            .domain(d3.range(n))
            .range(d3.schemeCategory20c);

        var series = g.selectAll(".series")
            .data(y01z)
            .enter().append("g")
            .attr("fill", function(d, i) { return color(i); });

        var rect = series.selectAll("rect")
            .data(function(d) { return d; })
            .enter().append("rect")
            .attr("x", function(d, i) { return x(i); })
            .attr("y", height)
            .attr("width", x.bandwidth())
            .attr("height", 0);

        rect.transition()
            .delay(function(d, i) { return i * 10; })
            .attr("y", function(d) { return y(d[1]); })
            .attr("height", function(d) { return y(d[0]) - y(d[1]); });

        g.append("g")
            .attr("class", "axis axis--x")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x)
                  .tickSize(0)
                  .tickPadding(6));

        d3.selectAll("input")
            .on("change", changed);

        var timeout = d3.timeout(function() {
            d3.select("input[value=\"grouped\"]")
                .property("checked", true)
                .dispatch("change");
        }, 2000);

        function changed() {
            timeout.stop();
            if (this.value === "grouped") transitionGrouped();
            else transitionStacked();
        }

          function transitionGrouped() {
              y.domain([0, yMax]);

        rect.transition()
            .duration(500)
            .delay(function(d, i) { return i * 10; })
            .attr("x", function(d, i) { return x(i) + x.bandwidth() / n * this.parentNode.__data__.key; })
            .attr("width", x.bandwidth() / n)
            .transition()
                .attr("y", function(d) { return y(d[1] - d[0]); })
                .attr("height", function(d) { return y(0) - y(d[1] - d[0]); });
          }

        function transitionStacked() {
            y.domain([0, y1Max]);

        rect.transition()
            .duration(500)
            .delay(function(d, i) { return i * 10; })
            .attr("y", function(d) { return y(d[1]); })
            .attr("height", function(d) { return y(d[0]) - y(d[1]); })
            .transition()
                .attr("x", function(d, i) { return x(i); })
                .attr("width", x.bandwidth());
        }
        /* //from sample code
        function bumps(m) {
        var values = [], i, j, w, x, y, z;

        // Initialize with uniform random values in [0.1, 0.2).
        for (i = 0; i < m; ++i) {
            values[i] = 0.1 + 0.1 * Math.random();
        }

        // Add five random bumps.
        for (j = 0; j < 5; ++j) {
            x = 1 / (0.1 + Math.random());
            y = 2 * Math.random() - 0.5;
            z = 10 / (0.1 + Math.random());
            for (i = 0; i < m; i++) {
                w = (i / m - y) * z;
                    values[i] += x * Math.exp(-w * w);
                    }
        }

        // Ensure all values are positive.
        for (i = 0; i < m; ++i) {
            values[i] = Math.max(0, values[i]);
        }

        return values;
        }*/
            
        /*var path = svg.selectAll('path')
          .data(pie(dataset))
          .enter()
          .append('path')
          .attr('d', arc)
          .attr('fill', function(d) {
            return color(d.data.label);
          })
          .each(function(d) { this._current = d;});
        */
        series.on('mouseover', function(d) {
            var total = d3.sum(dataset.map(function(d) {
                return (d.enabled)? d.count:0;
            }));
            var percent = Math.round(1000 * d.data.count / total) / 10; 
            tooltip.select('.label').html(d.data.label); 
            tooltip.select('.count').html(d.data.count); 
            tooltip.select('.percent').html(percent + '%'); 
            tooltip.style('display', 'block');
        });

        series.on('mouseout', function() { 
            tooltip.style('display', 'none');
        });
              
        series.on('mousemove', function(d) {
            tooltip.style('top', (d3.event.layerY + 10) + 'px') 
                .style('left', (d3.event.layerX + 10) + 'px');
        });
              

        var legend = g.append("g")
            .attr("font-family", "sans-serif")
            .attr("font-size", 10)
            .attr("text-anchor", "end")
            .selectAll("g")
            .data(keys.slice())
            .enter().append("g")
            .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
            
        legend.append("rect")
            .attr("x", width - 19)
            .attr("width", 19)
            .attr("height", 19)
            .attr("fill", z);
 
        legend.append("text")
            .attr("x", width - 24)
            .attr("y", 9.5)
            .attr("dy", "0.32em")
            .text(function(d) { return d; });
            
      })(window.d3);
        
    </script>
  </body>
</html>
